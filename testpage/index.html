<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Annotator Test Page</title>
    <meta name="description" content="Annotator Test Page">
    <meta name="author" content="VEMILab Clave Team">

    <link rel="stylesheet" href="/testpage/css/testpage.css">

    <!-- Annotator Dependencies -->
    <!-- Import JQuery -->
    <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
    <!-- Import JQueryUI -->
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- This is loading out of order using grunt so loading manually here - JPB -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.1/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.1/js/select2.min.js"></script>
    <!-- Annotator Core -->
    <script type="text/javascript" src="/dist/annotator-frontend.js"></script>
    <link rel="stylesheet" href="/dist/annotator-frontend.css">

    <!-- Dependencies we should include in the project instead of here -->

</head>

<body>
    <video playsinline width="640" height="480">
        <source src="http://sachinchoolur.github.io/lightGallery/static/videos/video2.mp4" type="video/mp4">
    </video>

    <div class="blah">Lorem Ipsum</div>

    <!-- If there is no DOM object with class waldorf-info, it will be created right below the video.
         If you manually create a div with that class, though, annotations will be inserted into the existing div. -->
    <div class='waldorf-info' aria-live='polite' aria-atomic='true'></div>
    <script>     
        //This is an advanced option to create a custom renderer for annotations
        var customRenderer = function(annotator, annotation, index){
            var $panel = $("<p></p>").appendTo($("<div></div>").appendTo(annotator.infoContainer.$container));
            //let text = JSON.stringify(annotation.AsOpenAnnotation(), null, 2);

            // Add clickable header that brings up the edit interface.
            var $header = $(`<b style="color: #ff0000">Annotation ${index + 1}:</b><br>`);
            console.log(annotator)
            if(annotator.kioskMode==false){
                $header = $(`<a href='' title='Edit Annotation'><b style="color: #ff0000">Annotation ${index + 1}:</b><br></a>`);
                $header.click( (event) => {
                    event.preventDefault();
                    annotator.gui.BeginEditing(annotation);
                });
            }

            $panel.append($header);
            var $content = $("<p></p>");
            
            
            $content.append("<b>Text: </b> " + annotation.body.filter(item => item.purpose === "describing")[0].value);
            $content.append("<br>");
            $content.append("<b>Tags: </b> " + annotation.tags.join(", "));
            $content.append("<br>");
            $content.append("<b>Time: </b> " 
                    + annotation.beginTime
                    + " - " 
                    + annotation.endTime);
            $content.append("<br>");

            $content.append("<b>Submitted by:</b><br />"
                    + (annotation.creator != null ? annotation.creator.email : "unspecified")
                    );

            //$paragraph.append("<strong>Annotation " + (index + 1) + ":</strong><br><pre>" + text.escapeHTML() + "</pre>");

            $panel.append($content);
            return $panel;
        }
    
        //This configuration connects to a live Statler server to edit and share annotations
        var serverAddress = "http://ec2-54-202-39-81.us-west-2.compute.amazonaws.com:3000";
        var tagsAddress = "https://onomy.org/published/83/json";
        var apiKey = "592c83c4-bc5c-4f07-8156-d98e4d48f707";
        $("video").first().annotate({serverURL: serverAddress, 
                                     tagsURL: tagsAddress, 
                                     apiKey: apiKey, 
                                     kioskMode: false,
                                     renderer: customRenderer});

        //This configuration loads annotations from a static W3C OA-formatted file
        // var localAnnotations = "/testpage/annotation_cache.json";
        // var tagsAddress = "https://onomy.org/published/83/json";
        // $("video").first().annotate({localURL: localAnnotations}); //kioskMode=true is implied

    </script>

</body>


</html>
